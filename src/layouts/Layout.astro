---
import { getTranslation, languages, getPath } from '../i18n';

interface Props {
  title?: string;
  description?: string;
  lang: string;
  alternates?: { lang: string; url: string }[];
}

const { title, description, lang, alternates = [] } = Astro.props;
const t = getTranslation(lang);
const fullTitle = title ? `${title} | ${t.site.title}` : t.site.title;
const fullDescription = description || t.site.description;

const currentPath = Astro.url.pathname.replace(/^\/(pt|es|en)/, '');
const siteUrl = import.meta.env.SITE_URL || Astro.site || 'https://your-site.pages.dev';
const hreflangs = alternates.length > 0 ? alternates : languages.map(l => ({
  lang: l.code,
  url: `${siteUrl}/${l.code}${currentPath}`
}));
---

<!doctype html>
<html lang={lang} class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <title>{fullTitle}</title>
    <meta name="description" content={fullDescription} />
    
    <!-- Hreflang -->
    {hreflangs.map(alt => (
      <link rel="alternate" hreflang={alt.lang} href={alt.url} />
    ))}
    <link rel="alternate" hreflang="x-default" href={`${siteUrl}/pt${currentPath}`} />
    
    <!-- Open Graph -->
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={fullDescription} />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content={lang === 'pt' ? 'pt_BR' : lang === 'es' ? 'es_ES' : 'en_US'} />
    
    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/" defer></script>
  </head>
  <body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">
    <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
      <nav class="container mx-auto px-4 py-4">
        <div class="flex justify-between items-center">
          <a href={getPath(lang)} class="text-2xl font-bold text-wood-400 hover:text-wood-300 transition">
            {t.site.title}
          </a>
          
          <div class="flex items-center gap-6">
            <a href={getPath(lang)} class="hover:text-wood-400 transition">{t.nav.home}</a>
            <a href={getPath(lang, '/blog')} class="hover:text-wood-400 transition">{t.nav.blog}</a>
            
            <!-- Language Switcher -->
            <div class="relative group">
              <button class="flex items-center gap-2 hover:text-wood-400 transition">
                {languages.find(l => l.code === lang)?.flag}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                {languages.map(l => (
                  <a 
                    href={`/${l.code}${currentPath}`}
                    class="block px-4 py-2 hover:bg-gray-700 first:rounded-t-lg last:rounded-b-lg transition"
                  >
                    {l.flag} {l.name}
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="flex-1">
      <slot />
    </main>

    <footer class="bg-gray-800 border-t border-gray-700 mt-20">
      <div class="container mx-auto px-4 py-8 text-center text-gray-400">
        <p>Â© {new Date().getFullYear()} {t.site.title}. {t.footer.rights}</p>
      </div>
    </footer>
  </body>
</html>

<style is:global>
  * {
    box-sizing: border-box;
  }
  
  body {
    font-family: system-ui, -apple-system, sans-serif;
  }
</style>
